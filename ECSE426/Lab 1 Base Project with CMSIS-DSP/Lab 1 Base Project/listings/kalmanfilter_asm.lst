


ARM Macro Assembler    Page 1 


    1 00000000                 AREA             text, CODE, READONLY
    2 00000000                 EXPORT           Kalmanfilter_asm
    3 00000000         
    4 00000000         Kalmanfilter_asm
    5 00000000         ; R0: pointer to input array
    6 00000000         ; R1: pointer to output array
    7 00000000         ; R2: pointer to struct
    8 00000000         ; R3: array length
    9 00000000         
   10 00000000         ; S0: value of q
   11 00000000         ; S1: value of r
   12 00000000         ; S2: value of x
   13 00000000         ; S3: value of p
   14 00000000         ; S4: value of k
   15 00000000         ; S5: value of next measurement from input
   16 00000000         ; S6: temp
   17 00000000         
   18 00000000         ;LOAD PARAMETERS FROM STRUCT ==============
   19 00000000         ;load q state
   20 00000000 ED92 0A00       VLDR.32          S0, [R2]
   21 00000004         ;load r state
   22 00000004 F102 0404       ADD              R4, R2, #4
   23 00000008 EDD4 0A00       VLDR.32          S1, [R4]
   24 0000000C         ;load x state
   25 0000000C F104 0404       ADD              R4, R4, #4
   26 00000010 ED94 1A00       VLDR.32          S2, [R4]
   27 00000014         ;load p state
   28 00000014 F104 0404       ADD              R4, R4, #4
   29 00000018 EDD4 1A00       VLDR.32          S3, [R4]
   30 0000001C         
   31 0000001C         ;LOOP =====================================
   32 0000001C         loop
   33 0000001C         
   34 0000001C         ;load next measurement from input array
   35 0000001C EDD0 2A00       VLDR.32          S5, [R0]
   36 00000020         ;increment input array index
   37 00000020 F100 0004       ADD              R0, R0, #4
   38 00000024         
   39 00000024         ;p = p + q
   40 00000024 EE71 1A80       VADD.F32         S3, S3, S0
   41 00000028         
   42 00000028         ;temp = p + r
   43 00000028 EE31 3AA0       VADD.F32         S6, S3, S1
   44 0000002C         ;k = p / p + r
   45 0000002C EE81 2A83       VDIV.F32         S4, S3, S6
   46 00000030         
   47 00000030         ;temp = measurement - x
   48 00000030 EE32 3AC1       VSUB.F32         S6, S5, S2
   49 00000034         ;temp = k * (measurement - x)
   50 00000034 EE22 3A03       VMUL.F32         S6, S4, S6
   51 00000038         ;x = x + k * (measurement - x)
   52 00000038 EE31 1A03       VADD.F32         S2, S2, S6
   53 0000003C         
   54 0000003C         ;temp = 1 - k
   55 0000003C EEF7 3A00       VLDR.F32         S7, =1.0
   56 00000040 EE33 3AC2       VSUB.F32         S6, S7, S4
   57 00000044         ;p = (1 - k) * p
   58 00000044 EE63 1A21       VMUL.F32         S3, S6, S3
   59 00000048         



ARM Macro Assembler    Page 2 


   60 00000048         ;store x value to output array
   61 00000048 ED81 1A00       VSTR.32          S2, [R1]
   62 0000004C         ;increment output array index
   63 0000004C F101 0104       ADD              R1, R1, #4
   64 00000050         
   65 00000050         ;decrement array length (# of elements remaining)
   66 00000050 1E5B            SUBS             R3, R3, #1
   67 00000052         ;if end of array not reached, loop
   68 00000052 D1E3            BNE              loop
   69 00000054         
   70 00000054         ;LOOP END=================================
   71 00000054         
   72 00000054         ;STORE PARAMETERS TO STRUCT ==============
   73 00000054         ;store q
   74 00000054 ED82 0A00       VSTR.32          S0, [R2]
   75 00000058         ;store r
   76 00000058 F102 0404       ADD              R4, R2, #4
   77 0000005C EDC4 0A00       VSTR.32          S1, [R4]
   78 00000060         ;store x
   79 00000060 F104 0404       ADD              R4, R4, #4
   80 00000064 ED84 1A00       VSTR.32          S2, [R4]
   81 00000068         ;store p
   82 00000068 F104 0404       ADD              R4, R4, #4
   83 0000006C EDC4 1A00       VSTR.32          S3, [R4]
   84 00000070         ;store k
   85 00000070 F104 0404       ADD              R4, R4, #4
   86 00000074 ED84 2A00       VSTR.32          S4, [R4]
   87 00000078         
   88 00000078 4770            BX               LR
   89 0000007A         
   90 0000007A                 END
Command Line: --debug --xref --cpu=Cortex-M4.fp --apcs=interwork --depend=.\obj
ect\kalmanfilter_asm.d -o.\object\kalmanfilter_asm.o -I"E:\Lab 1 Base Project w
ith CMSIS-DSP\Lab 1 Base Project\RTE" -I"E:\Lab 1 Base Project with CMSIS-DSP\L
ab 1 Base Project\RTE\Device\STM32F407VG" -IC:\Keil_v5\ARM\PACK\ARM\CMSIS\4.1.1
\CMSIS\Include -IC:\Keil_v5\ARM\PACK\Keil\STM32F4xx_DFP\1.0.8\Device\Include --
predefine="__MICROLIB SETA 1" --list=.\listings\kalmanfilter_asm.lst Kalmanfilt
er_asm.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

Kalmanfilter_asm 00000000

Symbol: Kalmanfilter_asm
   Definitions
      At line 4 in file Kalmanfilter_asm.s
   Uses
      At line 2 in file Kalmanfilter_asm.s
Comment: Kalmanfilter_asm used once
loop 0000001C

Symbol: loop
   Definitions
      At line 32 in file Kalmanfilter_asm.s
   Uses
      At line 68 in file Kalmanfilter_asm.s
Comment: loop used once
text 00000000

Symbol: text
   Definitions
      At line 1 in file Kalmanfilter_asm.s
   Uses
      None
Comment: text unused
3 symbols
335 symbols in table
